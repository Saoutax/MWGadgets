{"version":3,"file":"MassRollback.min.js","mappings":"mBAMa,SAAAA,IALb,IAAAC,EAAAC,EAAAC,EAAA,mBAAAC,OAAAA,OAAA,GAAAC,EAAAF,EAAAG,UAAA,aAAAC,EAAAJ,EAAAK,aAAA,yBAAAC,EAAAN,EAAAE,EAAAE,EAAAE,GAAA,IAAAC,EAAAL,GAAAA,EAAAM,qBAAAC,EAAAP,EAAAO,EAAAC,EAAAC,OAAAC,OAAAL,EAAAC,WAAA,OAAAK,EAAAH,EAAA,mBAAAV,EAAAE,EAAAE,GAAA,IAAAE,EAAAC,EAAAG,EAAAI,EAAA,EAAAC,EAAAX,GAAA,GAAAY,GAAA,EAAAC,EAAA,CAAAF,EAAA,EAAAb,EAAA,EAAAgB,EAAApB,EAAAqB,EAAAC,EAAAN,EAAAM,EAAAC,KAAAvB,EAAA,GAAAsB,EAAA,SAAArB,EAAAC,GAAA,OAAAM,EAAAP,EAAAQ,EAAA,EAAAG,EAAAZ,EAAAmB,EAAAf,EAAAF,EAAAmB,CAAA,YAAAC,EAAApB,EAAAE,GAAA,IAAAK,EAAAP,EAAAU,EAAAR,EAAAH,EAAA,GAAAiB,GAAAF,IAAAV,GAAAL,EAAAgB,EAAAO,OAAAvB,IAAA,KAAAK,EAAAE,EAAAS,EAAAhB,GAAAqB,EAAAH,EAAAF,EAAAQ,EAAAjB,EAAA,GAAAN,EAAA,GAAAI,EAAAmB,IAAArB,KAAAQ,EAAAJ,GAAAC,EAAAD,EAAA,OAAAC,EAAA,MAAAD,EAAA,GAAAA,EAAA,GAAAR,GAAAQ,EAAA,IAAAc,KAAAhB,EAAAJ,EAAA,GAAAoB,EAAAd,EAAA,KAAAC,EAAA,EAAAU,EAAAC,EAAAhB,EAAAe,EAAAf,EAAAI,EAAA,IAAAc,EAAAG,IAAAnB,EAAAJ,EAAA,GAAAM,EAAA,GAAAJ,GAAAA,EAAAqB,KAAAjB,EAAA,GAAAN,EAAAM,EAAA,GAAAJ,EAAAe,EAAAf,EAAAqB,EAAAhB,EAAA,OAAAH,GAAAJ,EAAA,SAAAmB,EAAA,MAAAH,GAAA,EAAAd,CAAA,iBAAAE,EAAAW,EAAAQ,GAAA,GAAAT,EAAA,QAAAU,UAAA,oCAAAR,GAAA,IAAAD,GAAAK,EAAAL,EAAAQ,GAAAhB,EAAAQ,EAAAL,EAAAa,GAAAxB,EAAAQ,EAAA,EAAAT,EAAAY,KAAAM,GAAA,CAAAV,IAAAC,EAAAA,EAAA,GAAAA,EAAA,IAAAU,EAAAf,GAAA,GAAAkB,EAAAb,EAAAG,IAAAO,EAAAf,EAAAQ,EAAAO,EAAAC,EAAAR,GAAA,OAAAI,EAAA,EAAAR,EAAA,IAAAC,IAAAH,EAAA,QAAAL,EAAAO,EAAAF,GAAA,MAAAL,EAAAA,EAAA0B,KAAAnB,EAAAI,IAAA,MAAAc,UAAA,wCAAAzB,EAAA2B,KAAA,OAAA3B,EAAAW,EAAAX,EAAA4B,MAAApB,EAAA,IAAAA,EAAA,YAAAA,IAAAR,EAAAO,EAAA,SAAAP,EAAA0B,KAAAnB,GAAAC,EAAA,IAAAG,EAAAc,UAAA,oCAAApB,EAAA,YAAAG,EAAA,GAAAD,EAAAR,CAAA,UAAAC,GAAAiB,EAAAC,EAAAf,EAAA,GAAAQ,EAAAV,EAAAyB,KAAAvB,EAAAe,MAAAE,EAAA,YAAApB,GAAAO,EAAAR,EAAAS,EAAA,EAAAG,EAAAX,CAAA,SAAAe,EAAA,UAAAa,MAAA5B,EAAA2B,KAAAV,EAAA,GAAAhB,EAAAI,EAAAE,IAAA,GAAAI,CAAA,KAAAS,EAAA,YAAAV,IAAA,UAAAmB,IAAA,UAAAC,IAAA,CAAA9B,EAAAY,OAAAmB,eAAA,IAAAvB,EAAA,GAAAL,GAAAH,EAAAA,EAAA,GAAAG,QAAAW,EAAAd,EAAA,GAAAG,EAAA,yBAAAH,GAAAW,EAAAmB,EAAArB,UAAAC,EAAAD,UAAAG,OAAAC,OAAAL,GAAA,SAAAO,EAAAhB,GAAA,OAAAa,OAAAoB,eAAApB,OAAAoB,eAAAjC,EAAA+B,IAAA/B,EAAAkC,UAAAH,EAAAhB,EAAAf,EAAAM,EAAA,sBAAAN,EAAAU,UAAAG,OAAAC,OAAAF,GAAAZ,CAAA,QAAA8B,EAAApB,UAAAqB,EAAAhB,EAAAH,EAAA,cAAAmB,GAAAhB,EAAAgB,EAAA,cAAAD,GAAAA,EAAAK,YAAA,oBAAApB,EAAAgB,EAAAzB,EAAA,qBAAAS,EAAAH,GAAAG,EAAAH,EAAAN,EAAA,aAAAS,EAAAH,EAAAR,EAAA,yBAAAW,EAAAH,EAAA,oDAAAb,EAAA,kBAAAqC,EAAA5B,EAAA6B,EAAArB,EAAA,cAAAD,EAAAf,EAAAE,EAAAE,EAAAH,GAAA,IAAAO,EAAAK,OAAAyB,eAAA,IAAA9B,EAAA,gBAAAR,GAAAQ,EAAA,EAAAO,EAAA,SAAAf,EAAAE,EAAAE,EAAAH,GAAA,SAAAK,EAAAJ,EAAAE,GAAAW,EAAAf,EAAAE,EAAA,SAAAF,GAAA,YAAAuC,QAAArC,EAAAE,EAAAJ,EAAA,GAAAE,EAAAM,EAAAA,EAAAR,EAAAE,EAAA,CAAA2B,MAAAzB,EAAAoC,YAAAvC,EAAAwC,cAAAxC,EAAAyC,UAAAzC,IAAAD,EAAAE,GAAAE,GAAAE,EAAA,UAAAA,EAAA,WAAAA,EAAA,cAAAS,EAAAf,EAAAE,EAAAE,EAAAH,EAAA,UAAA0C,EAAAvC,EAAAH,EAAAD,EAAAE,EAAAI,EAAAe,EAAAZ,GAAA,QAAAD,EAAAJ,EAAAiB,GAAAZ,GAAAG,EAAAJ,EAAAqB,KAAA,OAAAzB,GAAA,YAAAJ,EAAAI,EAAA,CAAAI,EAAAoB,KAAA3B,EAAAW,GAAAgC,QAAAC,QAAAjC,GAAAkC,KAAA5C,EAAAI,EAAA,UAAAyC,EAAA3C,GAAA,sBAAAH,EAAA,KAAAD,EAAAgD,UAAA,WAAAJ,QAAA,SAAA1C,EAAAI,GAAA,IAAAe,EAAAjB,EAAA6C,MAAAhD,EAAAD,GAAA,SAAAkD,EAAA9C,GAAAuC,EAAAtB,EAAAnB,EAAAI,EAAA4C,EAAAC,EAAA,OAAA/C,EAAA,UAAA+C,EAAA/C,GAAAuC,EAAAtB,EAAAnB,EAAAI,EAAA4C,EAAAC,EAAA,QAAA/C,EAAA,CAAA8C,OAAA,eAAAE,EAAAlD,EAAAF,GAAA,gBAAAE,GAAA,GAAAmD,MAAAC,QAAApD,GAAA,OAAAA,CAAA,CAAAqD,CAAArD,IAAA,SAAAA,EAAAuB,GAAA,IAAAxB,EAAA,MAAAC,EAAA,yBAAAC,QAAAD,EAAAC,OAAAE,WAAAH,EAAA,uBAAAD,EAAA,KAAAD,EAAAI,EAAAI,EAAAI,EAAAS,EAAA,GAAAL,GAAA,EAAAV,GAAA,SAAAE,GAAAP,EAAAA,EAAA0B,KAAAzB,IAAAsD,KAAA,IAAA/B,EAAA,IAAAZ,OAAAZ,KAAAA,EAAA,OAAAe,GAAA,cAAAA,GAAAhB,EAAAQ,EAAAmB,KAAA1B,IAAA2B,QAAAP,EAAAoC,KAAAzD,EAAA6B,OAAAR,EAAAG,SAAAC,GAAAT,GAAA,UAAAd,GAAAI,GAAA,EAAAF,EAAAF,CAAA,iBAAAc,GAAA,MAAAf,EAAA,SAAAW,EAAAX,EAAA,SAAAY,OAAAD,KAAAA,GAAA,kBAAAN,EAAA,MAAAF,CAAA,SAAAiB,CAAA,EAAAqC,CAAAxD,EAAAF,IAAA,SAAAE,EAAAmB,GAAA,GAAAnB,EAAA,qBAAAA,EAAA,OAAAyD,EAAAzD,EAAAmB,GAAA,IAAApB,EAAA,GAAA2D,SAAAjC,KAAAzB,GAAA2D,MAAA,uBAAA5D,GAAAC,EAAA4D,cAAA7D,EAAAC,EAAA4D,YAAAC,MAAA,QAAA9D,GAAA,QAAAA,EAAAoD,MAAAW,KAAA9D,GAAA,cAAAD,GAAA,2CAAAgE,KAAAhE,GAAA0D,EAAAzD,EAAAmB,QAAA,GAAA6C,CAAAhE,EAAAF,IAAA,qBAAA0B,UAAA,6IAAAyC,EAAA,UAAAR,EAAAzD,EAAAmB,IAAA,MAAAA,GAAAA,EAAAnB,EAAAsB,UAAAH,EAAAnB,EAAAsB,QAAA,QAAAxB,EAAA,EAAAI,EAAAiD,MAAAhC,GAAArB,EAAAqB,EAAArB,IAAAI,EAAAJ,GAAAE,EAAAF,GAAA,OAAAI,CAAA,CAMAgE,EAAEC,KAAKD,EAAEE,MAAOC,GAAGC,OAAOC,MAAM,CAAC,gBAAiB,8BAA8B3B,KAAK,WACjF,GAAoD,kBAAhDyB,GAAGG,OAAOC,IAAI,8BAAlB,CAIAP,EAAE,6BAA6BQ,KAAK,WAChC,IAAMC,EAASC,SAASC,cAAc,SACtCF,EAAOG,aAAa,OAAQ,YAC5BH,EAAOG,aAAa,aAAcC,KAAKC,uBAAuB,0BAA0B,GAAGC,WAC3FN,EAAOG,aAAa,aAAcC,KAAKG,aAAa,kBACpDH,KAAKI,QAAQR,EACjB,GAEAT,EAAE,gCAAgCkB,MAC9B,09BAUJlB,EAAE,uBAAuBmB,MAAM,WAC3BnB,EAAE,6BAA+BoB,KAAK,UAAW,SAACC,EAAIC,GAAG,OAAMA,CAAG,EACtE,GACAtB,EAAE,wBAAwBmB,MAAM,WAC5B,IAAMI,EAAcvB,EAAE,oDAChBwB,EAAaD,EAAYE,MAAMF,EAAYG,OAAO,mBAClDC,EAAYJ,EAAYE,MAAMF,EAAYG,OAAO,kBACvD,IAAoB,IAAhBF,IAAoC,IAAfG,GAAoBH,IAAeG,EAA5D,CACA,IAA+FC,EAAA5C,EAA1EwC,EAAaG,EAAY,CAACH,EAAYG,GAAa,CAACA,EAAWH,GAAW,GAAxFK,EAAKD,EAAA,GAAEE,EAAGF,EAAA,GACjBL,EAAY9B,MAAMoC,EAAOC,EAAM,GAAGV,KAAK,WAAW,EAF2B,CAGjF,GAEA,IAAMW,EAAM,IAAI5B,GAAG6B,IAEnBhC,EAAE,kCAAkCmB,MAAKxC,EAAAhD,IAAAsC,EAAC,SAAAgE,IAAA,IAAAC,EAAAC,EAAAC,EAAA,OAAAzG,IAAAqC,EAAA,SAAAqE,GAAA,cAAAA,EAAArG,GAAA,OAC0B,OAA1DkG,EAAUlC,EAAE,+CAA8CqC,EAAArG,EAAA,EAC3CsG,WAAWC,OAAO,cAADC,OAAeN,EAAQ9E,OAAM,2KAA2K,CAC1OqF,MAAO,UACPC,KAAM,SACNC,UAAU,IACZ,OAJU,GAKG,QALTR,EAAME,EAAArF,GAKO,CAAAqF,EAAArG,EAAA,eAAAqG,EAAApF,EAAA,UACnB2F,QAAQC,IAAI,WACNT,EAAOjC,GAAGG,OAAOC,IAAI,sBAC3B2B,EAAQ1B,KAAK,WACT,IAAMiC,EAAQ5B,KAAKG,aAAa,cAChC,IACIe,EAAIe,cAAc,WAAY,CAC1BC,OAAQ,WACRC,OAAQ,OACRP,MAAOA,EACPL,KAAMA,EACNa,QAAS9C,GAAGG,OAAOC,IAAI,gBAAgB2C,SAAS,WAAa/C,GAAGG,OAAOC,IAAI,gBAAgB2C,SAAS,UAAYxC,SAASyC,IAAID,SAAS,UACtIE,UAAW,WACXC,KAAM,kBACNC,QAASnB,EAAS,GAAHK,OAAML,EAAM,oBAAqB,oBACjDzD,KAAK,SAAC6E,GACLX,QAAQC,IAAI,MAADL,OAAOC,EAAK,MAAAD,OAAKe,GAChC,EACJ,CAAE,MAAO3H,GACLgH,QAAQC,IAAI,QAAAL,OAAQ5G,aAAe4H,MAAQ5H,EAAE6H,MAAMC,MAAM,MAAM,GAAGC,OAASC,KAAKC,UAAUjI,GAC9F,CACJ,GAAG,cAAAyG,EAAApF,EAAA,KAAAgF,EAAA,KAGPjC,EAAE,8BAA8BmB,MAAKxC,EAAAhD,IAAAsC,EAAC,SAAA6F,IAAA,IAAA5B,EAAAC,EAAA,OAAAxG,IAAAqC,EAAA,SAAA+F,GAAA,cAAAA,EAAA/H,GAAA,OAC8B,OAA1DkG,EAAUlC,EAAE,+CAA8C+D,EAAA/H,EAAA,EAC3CsG,WAAWC,OAAO,cAADC,OAAeN,EAAQ9E,OAAM,0GAA0G,CACzKqF,MAAO,UACPC,KAAM,SACNC,UAAU,IACZ,OAJU,GAKG,QALTR,EAAM4B,EAAA/G,GAKO,CAAA+G,EAAA/H,EAAA,eAAA+H,EAAA9G,EAAA,UACnB2F,QAAQC,IAAI,WACZX,EAAQ1B,KAAK,WACT,IAAMiC,EAAQ5B,KAAKG,aAAa,cAC5BgD,EAAQnD,KAAKG,aAAa,cAC9B,IACIe,EAAIe,cAAc,OAAQ,CACtBC,OAAQ,OACRC,OAAQ,OACRP,MAAOA,EACPwB,KAAMD,EACNX,KAAM,kBACNa,IAAK/D,GAAGG,OAAOC,IAAI,gBAAgB2C,SAAS,SAC5CE,UAAW,WACXE,QAASnB,EAAS,GAAHK,OAAML,EAAM,gBAAiB,gBAC7CzD,KAAK,SAAC6E,GACLX,QAAQC,IAAI,MAADL,OAAOC,EAAK,MAAAD,OAAKe,GAChC,EACJ,CAAE,MAAO3H,GACLgH,QAAQC,IAAI,QAAAL,OAAQ5G,aAAe4H,MAAQ5H,EAAE6H,MAAMC,MAAM,MAAM,GAAGC,OAASC,KAAKC,UAAUjI,GAC9F,CACJ,GAAG,cAAAmI,EAAA9G,EAAA,KAAA6G,EAAA,KAGP9D,EAAE,oCAAoCmB,MAAKxC,EAAAhD,IAAAsC,EAAC,SAAAkG,IAAA,IAAAjC,EAAAkC,EAAAjC,EAAA,OAAAxG,IAAAqC,EAAA,SAAAqG,GAAA,cAAAA,EAAArI,GAAA,OAEI,OADtCkG,EAAUlC,EAAE,+CACZoE,EAAWjE,GAAGG,OAAOC,IAAI,cAAa8D,EAAArI,EAAA,EACvBsG,WAAWC,OAAO,cAADC,OAAeN,EAAQ9E,OAAM,0GAA0G,CACzKqF,MAAO,UACPC,KAAM,SACNC,UAAU,IACZ,OAJU,GAKG,QALTR,EAAMkC,EAAArH,GAKO,CAAAqH,EAAArI,EAAA,eAAAqI,EAAApH,EAAA,UACnB2F,QAAQC,IAAI,WACZX,EAAQ1B,KAAK,WACT,IAAMiC,EAAQ5B,KAAKG,aAAa,cAChC,IACIe,EAAIe,cAAc,OAAQ,CACtBC,OAAQ,OACRC,OAAQ,OACRP,MAAOA,EACP6B,KAAM,0BAAF9B,OAA4B4B,EAAQ,OAAA5B,OAAML,EAAM,kBACpDkB,KAAM,kBACNa,IAAK/D,GAAGG,OAAOC,IAAI,gBAAgB2C,SAAS,SAC5CE,UAAW,WACXE,QAASnB,EAAS,GAAHK,OAAML,EAAM,kBAAmB,kBAC/CzD,KAAK,SAAC6E,GACLX,QAAQC,IAAI,MAADL,OAAOC,EAAK,MAAAD,OAAKe,GAChC,EACJ,CAAE,MAAO3H,GACLgH,QAAQC,IAAI,QAAAL,OAAQ5G,aAAe4H,MAAQ5H,EAAE6H,MAAMC,MAAM,MAAM,GAAGC,OAASC,KAAKC,UAAUjI,GAC9F,CACJ,GAAG,cAAAyI,EAAApH,EAAA,KAAAkH,EAAA,KAGPnE,EAAE,gCAAgCmB,MAAKxC,EAAAhD,IAAAsC,EAAC,SAAAsG,IAAA,IAAArC,EAAAC,EAAA,OAAAxG,IAAAqC,EAAA,SAAAwG,GAAA,cAAAA,EAAAxI,GAAA,OAC4B,OAA1DkG,EAAUlC,EAAE,+CAA8CwE,EAAAxI,EAAA,EAC3CsG,WAAWC,OAAO,cAADC,OAAeN,EAAQ9E,OAAM,iIAAiI,CAChMqF,MAAO,YACPC,KAAM,SACNC,UAAU,IACZ,OAJU,GAKG,QALTR,EAAMqC,EAAAxH,GAKO,CAAAwH,EAAAxI,EAAA,eAAAwI,EAAAvH,EAAA,UACnB2F,QAAQC,IAAI,aACZX,EAAQ1B,KAAK,WACT,IAAMiC,EAAQ5B,KAAKG,aAAa,cAC5BgD,EAAQnD,KAAKG,aAAa,cAC9B,IACIe,EAAIe,cAAc,OAAQ,CACtBC,OAAQ,iBACRC,OAAQ,OACRyB,KAAM,WACNC,OAAQjC,EACRkC,IAAKX,EACLX,KAAM,kBACNuB,KAAM,kBACNzC,OAAQA,EAAS,GAAHK,OAAML,EAAM,0BAA2B,0BACtDzD,KAAK,SAAC6E,GACLX,QAAQC,IAAI,QAADL,OAASC,EAAK,MAAAD,OAAKe,GAClC,EACJ,CAAE,MAAO3H,GACLgH,QAAQC,IAAI,UAAAL,OAAU5G,aAAe4H,MAAQ5H,EAAE6H,MAAMC,MAAM,MAAM,GAAGC,OAASC,KAAKC,UAAUjI,GAChG,CACJ,GAAG,cAAA4I,EAAAvH,EAAA,KAAAsH,EAAA,IA5JP,CA8JJ,E","sources":["webpack://mwgadgets/./src/MassRollback/index.js"],"sourcesContent":["/* TODO:\r\n    1.回退/撤销失败的页面给出控制台以外的提示\r\n    2.为管理员回退提供markbot可选框，无需以flood用户组或URL带bot视为开关\r\n    3.可能不需要连选功能，按住shift可自动连选，但移动设备无shift\r\n    4.使用ooui\r\n*/\r\n\"use strict\";\r\n$.when($.ready, mw.loader.using([\"mediawiki.api\", \"ext.gadget.libOOUIDialog\"])).then(() => {\r\n    if (mw.config.get(\"wgCanonicalSpecialPageName\") !== \"Contributions\") {\r\n        return;\r\n    }\r\n\r\n    $(\".mw-contributions-list li\").each(function () {\r\n        const newChk = document.createElement(\"input\");\r\n        newChk.setAttribute(\"type\", \"checkbox\");\r\n        newChk.setAttribute(\"data-title\", this.getElementsByClassName(\"mw-contributions-title\")[0].innerText);\r\n        newChk.setAttribute(\"data-revid\", this.getAttribute(\"data-mw-revid\"));\r\n        this.prepend(newChk);\r\n    });\r\n\r\n    $('div.mw-htmlform-ooui-wrapper').after(\r\n        '<div style=\"float: right; margin: 0.6em 0;\" id=\"mw-history-revision-actions\"> \\\r\n        <button class=\"cdx-button cdx-button--action-progressive\" id=\"mw-checkbox-invert\">全选/反选</button> \\\r\n        <button class=\"cdx-button cdx-button--action-progressive\" id=\"mw-checkbox-between\" title=\"请勾选需要操作的第一个和最后一个复选框后点击此按钮。\">连选</button> \\\r\n        <button class=\"cdx-button cdx-button--action-progressive cdx-button--weight-primary\" id=\"contributions-undo-button\">撤销</button> \\\r\n        <button class=\"cdx-button cdx-button--action-progressive cdx-button--weight-primary patroller-show\" id=\"contributions-rollback-button\" title=\"默认不启用markbotedit权限。\">回退</button> \\\r\n        <button class=\"cdx-button cdx-button--action-progressive cdx-button--weight-primary patroller-show\" id=\"contributions-flagdelete-button\">挂删</button> \\\r\n        <button class=\"cdx-button cdx-button--action-progressive cdx-button--weight-primary sysop-show\" id=\"contributions-revdel-button\" title=\"默认仅删除内容和摘要。\">版本删除</button> \\\r\n        </div>',\r\n    );\r\n\r\n    $(\"#mw-checkbox-invert\").click(() => {\r\n        $(\"li input[type=\\\"checkbox\\\"]\").prop(\"checked\", (_i, ele) => !ele);\r\n    });\r\n    $(\"#mw-checkbox-between\").click(() => {\r\n        const $checkboxes = $(\".mw-contributions-list li input[type='checkbox']\");\r\n        const firstIndex = $checkboxes.index($checkboxes.filter(\":checked:first\"));\r\n        const lastIndex = $checkboxes.index($checkboxes.filter(\":checked:last\"));\r\n        if (firstIndex === -1 || lastIndex === -1 || firstIndex === lastIndex) return;\r\n        const [start, end] = firstIndex < lastIndex ? [firstIndex, lastIndex] : [lastIndex, firstIndex];\r\n        $checkboxes.slice(start, end + 1).prop(\"checked\", true);\r\n    });\r\n\r\n    const api = new mw.Api();\r\n\r\n    $(\"#contributions-rollback-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面</li><li>批量回退操作的编辑摘要：<code>xxx// MassRollback</code></li><li>空白则使用默认回退摘要，取消则不进行回退</li><li>管理员可自授权机器用户或在URL后添加<code>bot=1</code>以启用markbotedit。</li></ul><hr>请输入回退摘要：`, {\r\n            title: \"批量回退小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始回退...\");\r\n        const user = mw.config.get(\"wgRelevantUserName\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\");\r\n            try {\r\n                api.postWithToken(\"rollback\", {\r\n                    action: \"rollback\",\r\n                    format: \"json\",\r\n                    title: title,\r\n                    user: user,\r\n                    markbot: mw.config.get(\"wgUserGroups\").includes(\"sysop\") && (mw.config.get(\"wgUserGroups\").includes(\"flood\") || document.URL.includes(\"bot=1\")),\r\n                    watchlist: \"nochange\",\r\n                    tags: \"Automation tool\",\r\n                    summary: reason ? `${reason} // MassRollback` : \"// MassRollback\",\r\n                }).then((result) => {\r\n                    console.log(`回退：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`回退失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n\r\n    $(\"#contributions-undo-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面</li><li>批量撤销操作的编辑摘要：<code>xxx// MassUndo</code></li><li>空白则使用默认撤销摘要，取消则不进行撤销</li></ul><hr>请输入撤销摘要：`, {\r\n            title: \"批量撤销小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始撤销...\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\"),\r\n                revid = this.getAttribute(\"data-revid\");\r\n            try {\r\n                api.postWithToken(\"csrf\", {\r\n                    action: \"edit\",\r\n                    format: \"json\",\r\n                    title: title,\r\n                    undo: revid,\r\n                    tags: \"Automation tool\",\r\n                    bot: mw.config.get(\"wgUserGroups\").includes(\"flood\"),\r\n                    watchlist: \"nochange\",\r\n                    summary: reason ? `${reason} // MassUndo` : \"// MassUndo\",\r\n                }).then((result) => {\r\n                    console.log(`撤销：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`撤销失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n\r\n    $(\"#contributions-flagdelete-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const username = mw.config.get(\"wgUserName\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面</li><li>批量挂删操作的编辑摘要：<code>xxx// MassDelete</code></li><li>空白则使用默认摘要，取消则不进行挂删</li></ul><hr>请输入挂删摘要：`, {\r\n            title: \"批量挂删小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始挂删...\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\");\r\n            try {\r\n                api.postWithToken(\"csrf\", {\r\n                    action: \"edit\",\r\n                    format: \"json\",\r\n                    title: title,\r\n                    text: `<noinclude>{{即将删除|user=${username}|1=${reason}}}</noinclude>`,\r\n                    tags: \"Automation tool\",\r\n                    bot: mw.config.get(\"wgUserGroups\").includes(\"flood\"),\r\n                    watchlist: \"nochange\",\r\n                    summary: reason ? `${reason} // MassDelete` : \"// MassDelete\",\r\n                }).then((result) => {\r\n                    console.log(`挂删：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`挂删失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n\r\n    $(\"#contributions-revdel-button\").click(async () => {\r\n        const checked = $(\".mw-contributions-list li :checkbox:checked\");\r\n        const reason = await oouiDialog.prompt(`<ul><li>选中了${checked.length}个页面，将删除版本内容和编辑摘要</li><li>批量版本删除的原因：<code>xxx// MassRevisionDelete</code></li><li>空白则使用默认原因，取消则不进行版本删除</li></ul><hr>请输入版本删除原因：`, {\r\n            title: \"批量版本删除小工具\",\r\n            size: \"medium\",\r\n            required: false,\r\n        });\r\n        if (reason === null) { return; }\r\n        console.log(\"开始版本删除...\");\r\n        checked.each(function () {\r\n            const title = this.getAttribute(\"data-title\"),\r\n                revid = this.getAttribute(\"data-revid\");\r\n            try {\r\n                api.postWithToken(\"csrf\", {\r\n                    action: \"revisiondelete\",\r\n                    format: \"json\",\r\n                    type: \"revision\",\r\n                    target: title,\r\n                    ids: revid,\r\n                    tags: \"Automation tool\",\r\n                    hide: \"comment|content\",\r\n                    reason: reason ? `${reason} // MassRevisionDelete` : \"// MassRevisionDelete\",\r\n                }).then((result) => {\r\n                    console.log(`版本删除：${title}\\n${result}`);\r\n                });\r\n            } catch (e) {\r\n                console.log(`版本删除失败：${e}` instanceof Error ? e.stack.split(\"\\n\")[1].trim() : JSON.stringify(e));\r\n            }\r\n        });\r\n    });\r\n});"],"names":["_regenerator","e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_slicedToArray","Array","isArray","_arrayWithHoles","next","push","_iterableToArrayLimit","_arrayLikeToArray","toString","slice","constructor","name","from","test","_unsupportedIterableToArray","_nonIterableRest","$","when","ready","mw","loader","using","config","get","each","newChk","document","createElement","setAttribute","this","getElementsByClassName","innerText","getAttribute","prepend","after","click","prop","_i","ele","$checkboxes","firstIndex","index","filter","lastIndex","_ref2","start","end","api","Api","_callee","checked","reason","user","_context","oouiDialog","prompt","concat","title","size","required","console","log","postWithToken","action","format","markbot","includes","URL","watchlist","tags","summary","result","Error","stack","split","trim","JSON","stringify","_callee2","_context2","revid","undo","bot","_callee3","username","_context3","text","_callee4","_context4","type","target","ids","hide"],"sourceRoot":""}