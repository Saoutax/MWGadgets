{"version":3,"file":"CleanPreload.min.js","mappings":"mBAAAA,EAAE,WACE,GAA2C,IAAvCC,GAAGC,OAAOC,IAAI,uBACmB,IAAlCF,GAAGC,OAAOC,IAAI,iBAA0D,IAAjCF,GAAGC,OAAOC,IAAI,iBACpDF,GAAGC,OAAOC,IAAI,eAFlB,CAMA,IAAMC,EAAOH,GAAGI,KAAKC,eAAe,aAAc,IAAK,QAAS,gBAAiB,QAAS,KAE1FN,EAAEI,GAAMG,GAAG,QAAS,SAASC,GACzBA,EAAEC,iBACF,IAAMC,EAAWT,GAAGC,OAAOC,IAAI,cACzBQ,EAAM,IAAIV,GAAGW,IAEnBD,EAAIR,IAAI,CACJU,OAAQ,QACRC,OAAQJ,EACRK,KAAM,YACNC,OAAQ,UACRC,cAAe,MAChBC,KAAK,SAASC,GACb,IAAKA,EAAKC,QAAUD,EAAKC,MAAMC,OAAqC,IAA5BF,EAAKC,MAAMC,MAAMC,OACrD,MAAM,IAAIC,MAAM,YAEpB,IACMC,EADOL,EAAKC,MAAMC,MAAM,GACTI,UAAU,GAAGD,QAC5BE,EAAaF,EAAQG,QAAQ,mBAAoB,IACvD,GAAIH,IAAYE,EAIhB,OAAOf,EAAIiB,cAAc,OAAQ,CAC7Bf,OAAQ,OACRgB,MAAOnB,EACPoB,KAAMJ,EACNK,QAAS,0CACTC,KAAM,kBACNC,UAAW,aATXhC,GAAGiC,OAAO,gBAWlB,GAAGhB,KAAK,WACJjB,GAAGiC,OAAO,kBACVC,WAAW,WACPC,SAASC,QACb,EAAG,IACP,GAAE,MAAO,SAASC,GACdrC,GAAGiC,OAAO,SAAWI,GACrBC,QAAQD,MAAM,WAAYA,EAC9B,EACJ,EA3CA,CA4CJ,E","sources":["webpack://mwgadgets/./src/CleanPreload/index.js"],"sourcesContent":["$(function() {\n    if (mw.config.get(\"wgNamespaceNumber\") !== 0\n    || mw.config.get(\"wgRevisionId\") === 0 && mw.config.get(\"wgArticleId\") === 0\n    || !mw.config.get(\"wgIsArticle\") ) {\n        return;\n    }\n\n    const link = mw.util.addPortletLink(\"p-cactions\", \"#\", \"清理预加载\", \"clear-preload\", \"清理预加载\", \"l\");\n\n    $(link).on(\"click\", function(e) {\n        e.preventDefault();\n        const pageName = mw.config.get(\"wgPageName\");\n        const api = new mw.Api();\n\n        api.get({\n            action: \"query\",\n            titles: pageName,\n            prop: \"revisions\",\n            rvprop: \"content\",\n            formatversion: \"2\"\n        }).then(function(data) {\n            if (!data.query || !data.query.pages || data.query.pages.length === 0) {\n                throw new Error(\"无法获取页面数据\");\n            }\n            const page = data.query.pages[0];\n            const content = page.revisions[0].content;\n            const newContent = content.replace(/<!--[\\s\\S]*?-->/g, \"\");\n            if (content === newContent) {\n                mw.notify(\"未找到需要清理的预加载内容\");\n                return;\n            }\n            return api.postWithToken(\"csrf\", {\n                action: \"edit\",\n                title: pageName,\n                text: newContent,\n                summary: \"[[User:SaoMikoto/js#快速移除预加载模板|移除预加载模板]]\",\n                tags: \"Automation tool\",\n                watchlist: \"nochange\"\n            });\n        }).then(function() {\n            mw.notify(\"清理完成，即将刷新页面...\");\n            setTimeout(function() {\n                location.reload();\n            }, 2000);\n        }).catch(function(error) {\n            mw.notify(\"操作失败: \" + error);\n            console.error(\"清理预加载出错：\", error);\n        });\n    });\n});"],"names":["$","mw","config","get","link","util","addPortletLink","on","e","preventDefault","pageName","api","Api","action","titles","prop","rvprop","formatversion","then","data","query","pages","length","Error","content","revisions","newContent","replace","postWithToken","title","text","summary","tags","watchlist","notify","setTimeout","location","reload","error","console"],"sourceRoot":""}