{"version":3,"file":"CleanPreload.min.js","mappings":"mBAAAA,EAAE,WACE,GAA2C,IAAvCC,GAAGC,OAAOC,IAAI,uBACmB,IAAlCF,GAAGC,OAAOC,IAAI,iBAA0D,IAAjCF,GAAGC,OAAOC,IAAI,iBACpDF,GAAGC,OAAOC,IAAI,eAFlB,CAMA,IAAMC,EAAOH,GAAGI,KAAKC,eAAe,aAAc,IAAK,QAAS,gBAAiB,QAAS,KAE1FN,EAAEI,GAAMG,GAAG,QAAS,SAASC,GACzBA,EAAEC,iBACF,IAAMC,EAAWT,GAAGC,OAAOC,IAAI,cACzBQ,EAAM,IAAIV,GAAGW,IAEnBD,EAAIR,IAAI,CACJU,OAAQ,QACRC,OAAQJ,EACRK,KAAM,YACNC,OAAQ,UACRC,cAAe,MAChBC,KAAK,SAASC,GACb,IAAKA,EAAKC,QAAUD,EAAKC,MAAMC,OAAqC,IAA5BF,EAAKC,MAAMC,MAAMC,OACrD,MAAM,IAAIC,MAAM,YAEpB,IACMC,EADOL,EAAKC,MAAMC,MAAM,GACTI,UAAU,GAAGD,QAC5BE,EAAaF,EAAQG,QAAQ,mBAAoB,IACvD,GAAIH,IAAYE,EAIhB,OAAOf,EAAIiB,cAAc,OAAQ,CAC7Bf,OAAQ,OACRgB,MAAOnB,EACPoB,KAAMJ,EACNK,QAAS,0CACTC,KAAM,kBACNC,UAAW,aATXhC,GAAGiC,OAAO,gBAWlB,GAAGhB,KAAK,WACJjB,GAAGiC,OAAO,kBACVC,WAAW,WACPC,SAASC,QACb,EAAG,IACP,GAAE,MAAO,SAASC,GACdrC,GAAGiC,OAAO,SAAWI,GACrBC,QAAQD,MAAM,WAAYA,EAC9B,EACJ,EA3CA,CA4CJ,E","sources":["webpack://mwgadgets/./src/CleanPreload/index.js"],"sourcesContent":["$(function() {\r\n    if (mw.config.get('wgNamespaceNumber') !== 0\r\n    || mw.config.get(\"wgRevisionId\") === 0 && mw.config.get(\"wgArticleId\") === 0\r\n    || !mw.config.get(\"wgIsArticle\") ) {\r\n        return;\r\n    }\r\n\r\n    const link = mw.util.addPortletLink(\"p-cactions\", \"#\", \"清理预加载\", \"clear-preload\", \"清理预加载\", \"l\");\r\n\r\n    $(link).on(\"click\", function(e) {\r\n        e.preventDefault();\r\n        const pageName = mw.config.get(\"wgPageName\");\r\n        const api = new mw.Api();\r\n\r\n        api.get({\r\n            action: \"query\",\r\n            titles: pageName,\r\n            prop: \"revisions\",\r\n            rvprop: \"content\",\r\n            formatversion: \"2\"\r\n        }).then(function(data) {\r\n            if (!data.query || !data.query.pages || data.query.pages.length === 0) {\r\n                throw new Error(\"无法获取页面数据\");\r\n            }\r\n            const page = data.query.pages[0];\r\n            const content = page.revisions[0].content;\r\n            const newContent = content.replace(/<!--[\\s\\S]*?-->/g, '');\r\n            if (content === newContent) {\r\n                mw.notify(\"未找到需要清理的预加载内容\");\r\n                return;\r\n            }\r\n            return api.postWithToken(\"csrf\", {\r\n                action: \"edit\",\r\n                title: pageName,\r\n                text: newContent,\r\n                summary: \"[[User:SaoMikoto/js#快速移除预加载模板|移除预加载模板]]\",\r\n                tags: \"Automation tool\",\r\n                watchlist: \"nochange\"\r\n            });\r\n        }).then(function() {\r\n            mw.notify(\"清理完成，即将刷新页面...\");\r\n            setTimeout(function() {\r\n                location.reload();\r\n            }, 2000);\r\n        }).catch(function(error) {\r\n            mw.notify(\"操作失败: \" + error);\r\n            console.error(\"清理预加载出错：\", error);\r\n        });\r\n    });\r\n});"],"names":["$","mw","config","get","link","util","addPortletLink","on","e","preventDefault","pageName","api","Api","action","titles","prop","rvprop","formatversion","then","data","query","pages","length","Error","content","revisions","newContent","replace","postWithToken","title","text","summary","tags","watchlist","notify","setTimeout","location","reload","error","console"],"sourceRoot":""}