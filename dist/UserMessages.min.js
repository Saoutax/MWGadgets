(()=>{"use strict";function t(){var a,r,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",l=n.toStringTag||"@@toStringTag";function i(t,n,s,l){var i=n&&n.prototype instanceof m?n:m,c=Object.create(i.prototype);return e(c,"_invoke",function(t,e,n){var s,l,i,m=0,c=n||[],u=!1,p={p:0,n:0,v:a,a:d,f:d.bind(a,4),d:function(t,e){return s=t,l=0,i=a,p.n=e,o}};function d(t,e){for(l=t,i=e,r=0;!u&&m&&!n&&r<c.length;r++){var n,s=c[r],d=p.p,y=s[2];t>3?(n=y===e)&&(i=s[(l=s[4])?5:(l=3,3)],s[4]=s[5]=a):s[0]<=d&&((n=t<2&&d<s[1])?(l=0,p.v=e,p.n=s[1]):d<y&&(n=t<3||s[0]>e||e>y)&&(s[4]=t,s[5]=e,p.n=y,l=0))}if(n||t>1)return o;throw u=!0,e}return function(n,c,y){if(m>1)throw TypeError("Generator is already running");for(u&&1===c&&d(c,y),l=c,i=y;(r=l<2?a:i)||!u;){s||(l?l<3?(l>1&&(p.n=-1),d(l,i)):p.n=i:p.v=i);try{if(m=2,s){if(l||(n="next"),r=s[n]){if(!(r=r.call(s,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,l<2&&(l=0)}else 1===l&&(r=s.return)&&r.call(s),l<2&&(i=TypeError("The iterator does not provide a '"+n+"' method"),l=1);s=a}else if((r=(u=p.n<0)?i:t.call(e,p))!==o)break}catch(t){s=a,l=1,i=t}finally{m=1}}return{value:r,done:u}}}(t,s,l),!0),c}var o={};function m(){}function c(){}function u(){}r=Object.getPrototypeOf;var p=[][s]?r(r([][s]())):(e(r={},s,function(){return this}),r),d=u.prototype=m.prototype=Object.create(p);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,e(t,l,"GeneratorFunction")),t.prototype=Object.create(d),t}return c.prototype=u,e(d,"constructor",u),e(u,"constructor",c),c.displayName="GeneratorFunction",e(u,l,"GeneratorFunction"),e(d),e(d,l,"Generator"),e(d,s,function(){return this}),e(d,"toString",function(){return"[object Generator]"}),(t=function(){return{w:i,m:y}})()}function e(t,a,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(t){s=0}e=function(t,a,r,n){function l(a,r){e(t,a,function(t){return this._invoke(a,r,t)})}a?s?s(t,a,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[a]=r:(l("next",0),l("throw",1),l("return",2))},e(t,a,r,n)}function a(t,e,a,r,n,s,l){try{var i=t[s](l),o=i.value}catch(t){return void a(t)}i.done?e(o):Promise.resolve(o).then(r,n)}function r(t){return function(){var e=this,r=arguments;return new Promise(function(n,s){var l=t.apply(e,r);function i(t){a(l,n,s,i,o,"next",t)}function o(t){a(l,n,s,i,o,"throw",t)}i(void 0)})}}mw.loader.using(["mediawiki.api","@wikimedia/codex"]).then(function(e){var a=mw.config.get("wgNamespaceNumber"),n=mw.config.get("wgCanonicalSpecialPageName");if([1,2,-1].includes(a)&&(-1!==a||["Contributions","DeletedContributions","Block","Log"].includes(n))){var s=mw.util.addPortletLink("p-cactions","#","向用户发送提醒","p-usermessages"),l=e("vue"),i=e("@wikimedia/codex"),o=document.body.appendChild(document.createElement("div")),m=new mw.Api;mw.util.addCSS("\n\t\t.umdev-dialog-content {\n\t\t\tmax-height: 70vh;\n\t\t\toverflow-y: auto;\n\t\t\tpadding-right: 8px;\n\t\t}\n\t\t.umdev-textarea textarea {\n\t\t\tresize: vertical !important;\n\t\t\tmax-height: 400px;\n\t\t\toverflow-y: auto !important;\n\t\t}\n\t"),l.createMwApp({data:function(){return{showDialog:!1,selected:null,editSummary:"",showPreview:!1,previewHtml:"",previewWikitext:"",parameterValues:{},customMode:!1,customText:"",loadingSource:!1,sending:!1,templates:[{title:"欢迎",template:"Template:UserMessages/Welcome",parameters:[],summary:"Welcome to Moegirlpedia~"},{title:"优质编辑者",template:"Template:UserMessages/GoodEditor",parameters:[{key:"1",label:"选填原因"}],summary:"恭喜您成为萌娘百科优质编辑者！"},{title:"可收录页面打回",template:"Template:UserMessages/MovedToUserSubpage",parameters:[{key:"1",label:"页面名"},{key:"2",label:"原因"}],summary:"页面打回通知"},{title:"非收录页面打回",template:"Template:UserMessages/MovedToUserSubpage2",parameters:[{key:"1",label:"页面名"},{key:"2",label:"原因"}],summary:"页面打回通知"},{title:"著作权侵犯",template:"Template:UserMessages/ArticleCopyright",parameters:[{key:"1",label:"页面名"},{key:"2",label:"选填站点"}],summary:"请勿侵犯著作权"},{title:"不实信息",template:"Template:UserMessages/FalseInformation",parameters:[{key:"1",label:"页面名"}],summary:"请勿添加不实信息"},{title:"Wiki语法",template:"Template:UserMessages/WikiMarkupLanguage",parameters:[],summary:"关于Wiki语法"},{title:"剪贴移动",template:"Template:UserMessages/CutAndPasteMoving",parameters:[{key:"1",label:"页面名"}],summary:"请勿剪切移动页面"},{title:"编辑用户页",template:"Template:UserMessages/EditUserPage",parameters:[{key:"1",label:"页面名"}],summary:"请勿编辑他人用户页面"},{title:"幽默模板",template:"Template:UserMessages/HumorTemplate",parameters:[{key:"1",label:"选填页面名"},{key:"2",label:"选填行为"}],summary:"关于幽默模板的使用"},{title:"违规字词转换",template:"Template:UserMessages/ConversionViolation",parameters:[{key:"1",label:"选填页面名"},{key:"2",label:"选填行为"}],summary:"关于您近期的编辑"},{title:"文件授权协议",template:"Template:UserMessages/FileLicense",parameters:[{key:"1",label:"文件名"}],summary:"关于您近期上传的文件"},{title:"截图文件授权",template:"Template:UserMessages/FileLicense2",parameters:[{key:"1",label:"文件名"}],summary:"关于您近期上传的截图文件"},{title:"用户文件",template:"Template:UserMessages/UserFile",parameters:[],summary:"关于您上传的文件"},{title:"修改历史发言",template:"Template:UserMessages/DiscussionViolation",parameters:[{key:"1",label:"选填页面名或差异"}],summary:"关于您在讨论区的发言"},{title:"违反讨论区方针",template:"Template:UserMessages/DiscussionViolation2",parameters:[{key:"1",label:"页面名或差异"},{key:"2",label:"原因"}],summary:"关于您在讨论区的发言"},{title:"删除历史发言",template:"Template:UserMessages/DiscussionViolation3",parameters:[{key:"1",label:"选填页面名或差异"}],summary:"关于您在讨论区的行为"},{title:"人身攻击提醒",template:"Template:UserMessages/PersonalAttacks",parameters:[{key:"1",label:"页面名"},{key:"2",label:"选填用户"}],summary:"请勿人身攻击"},{title:"人身攻击警告",template:"Template:UserMessages/PersonalAttacks2",parameters:[],summary:"人身攻击警告"},{title:"未签名",template:"Template:UserMessages/Signature",parameters:[{key:"1",label:"页面名"}],summary:"关于您的签名"},{title:"签名违规",template:"Template:UserMessages/Signature2",parameters:[{key:"1",label:"页面名"}],summary:"关于您的签名"},{title:"编辑战通知",template:"Template:UserMessages/EditWar",parameters:[{key:"1",label:"页面名"}],summary:"提醒您参与讨论"},{title:"编辑战提醒",template:"Template:UserMessages/EditWar2",parameters:[{key:"1",label:"页面名"}],summary:"编辑战提醒"},{title:"编辑战警告",template:"Template:UserMessages/EditWar3",parameters:[{key:"1",label:"页面名"},{key:"2",label:"选填原因"}],summary:"编辑战警告"},{title:"最终警告",template:"Template:UserMessages/FinalWarning",parameters:[{key:"1",label:"选填原因"},{key:"2",label:"选填原因"}],summary:"警告：忍耐是有限的"},{title:"大家族模板排序",template:"Template:UserMessages/NavSort",parameters:[{key:"1",label:"页面名"}],summary:"关于大家族模板的排序"},{title:"回复无缩进",template:"Template:UserMessages/ReplyNoIndentation",parameters:[{key:"1",label:"页面名"},{key:"2",label:"被回复人"}],summary:"关于您在讨论区的发言"},{title:"超速编辑",template:"Template:UserMessages/OverSpeedEdit",parameters:[],summary:"关于您近期的编辑"}],primaryAction:{label:"预览",actionType:"progressive"}}},computed:{menuItems:function(){return this.templates.map(function(t,e){return{label:t.title,value:e}})},selectedTemplate:function(){return null!==this.selected&&this.templates[this.selected]||null},previewActions:function(){return{default:{label:"关闭"},primary:{label:this.sending?"发送中...":"发送提醒",actionType:"progressive",disabled:this.sending}}}},watch:{selected:function(t){null!==t&&(this.editSummary=this.templates[t].summary,this.parameterValues={},this.customMode=!1,this.customText="")},customMode:function(e){var a=this;return r(t().m(function r(){return t().w(function(t){for(;;)switch(t.n){case 0:if(!e||!a.selectedTemplate){t.n=1;break}return t.n=1,a.loadTemplateSource(a.selectedTemplate.template);case 1:return t.a(2)}},r)}))()}},template:'\n\t\t\t\x3c!-- 主对话框 --\x3e\n\t\t\t<cdx-dialog\n\t\t\t\tv-model:open="showDialog"\n\t\t\t\ttitle="向用户发送提醒"\n\t\t\t\t:use-close-button="true"\n\t\t\t\t:primary-action="primaryAction"\n\t\t\t\t@primary="previewTemplate"\n\t\t\t>\n\t\t\t\t<div class="umdev-dialog-content">\n\t\t\t\t\t<cdx-field>\n\t\t\t\t\t\t<template #label>选择模板</template>\n\t\t\t\t\t\t<cdx-select\n\t\t\t\t\t\t\tv-model:selected="selected"\n\t\t\t\t\t\t\t:menu-items="menuItems"\n\t\t\t\t\t\t\tdefault-label="请选择模板"\n\t\t\t\t\t\t></cdx-select>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field v-if="selectedTemplate">\n\t\t\t\t\t\t<cdx-checkbox v-model="customMode">\n\t\t\t\t\t\t\t自定义内容\n\t\t\t\t\t\t</cdx-checkbox>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field\n\t\t\t\t\t\tv-for="(param, index) in (selectedTemplate?.parameters || [])"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\tv-if="selectedTemplate && !customMode"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #label>{{ param.label }}</template>\n\t\t\t\t\t\t<cdx-text-input v-model="parameterValues[param.key]"></cdx-text-input>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field>\n\t\t\t\t\t\t<template #label>编辑摘要</template>\n\t\t\t\t\t\t<cdx-text-input v-model="editSummary"></cdx-text-input>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field v-if="customMode">\n\t\t\t\t\t\t<template #label>自定义内容</template>\n\t\t\t\t\t\t<cdx-text-area\n\t\t\t\t\t\t\tv-model="customText"\n\t\t\t\t\t\t\t:autosize="true"\n\t\t\t\t\t\t\trows="6"\n\t\t\t\t\t\t\tclass="umdev-textarea"\n\t\t\t\t\t\t></cdx-text-area>\n\t\t\t\t\t\t<div v-if="loadingSource">正在加载模板源代码...</div>\n\t\t\t\t\t</cdx-field>\n\t\t\t\t</div>\n\t\t\t</cdx-dialog>\n\n\t\t\t<cdx-dialog\n\t\t\t\tv-if="showPreview"\n\t\t\t\tv-model:open="showPreview"\n\t\t\t\ttitle="预览"\n\t\t\t\t:use-close-button="true"\n\t\t\t\t:default-action="previewActions.default"\n\t\t\t\t:primary-action="previewActions.primary"\n\t\t\t\t@default="showPreview = false"\n\t\t\t\t@primary="sendToTalkPage"\n\t\t\t>\n\t\t\t\t<div class="umdev-dialog-content" v-html="previewHtml"></div>\n\t\t\t</cdx-dialog>\n\t\t',methods:{openDialog:function(){this.showDialog=!0},loadTemplateSource:function(e){var a=this;return r(t().m(function r(){var n,s,l,i,o;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return a.loadingSource=!0,t.p=1,t.n=2,m.get({action:"query",prop:"revisions",rvprop:"content",titles:e,formatversion:2});case 2:s=t.v,l=s.query.pages[0],i=(i=(null===(n=l.revisions)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.content)||"").replace(/<noinclude>[\s\S]*?<\/noinclude>/gi,"").replace(/<includeonly>[\s\S]*?<\/includeonly>/gi,"").replace(/<onlyinclude>|<\/onlyinclude>/gi,""),a.customText=i.trim(),t.n=4;break;case 3:t.p=3,o=t.v,a.customText="加载模板源代码失败：".concat(o);case 4:return t.p=4,a.loadingSource=!1,t.f(4);case 5:return t.a(2)}},r,null,[[1,3,4,5]])}))()},previewTemplate:function(){var e=this;return r(t().m(function a(){var r,n,s,l,i;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r="",!e.customMode){t.n=1;break}r=e.customText,t.n=3;break;case 1:if(s=e.selectedTemplate){t.n=2;break}return t.a(2);case 2:r="{{".concat(s.template),null!==(n=s.parameters)&&void 0!==n&&n.length&&s.parameters.forEach(function(t){var a=e.parameterValues[t.key];a&&(r+="|".concat(t.key,"=").concat(a))}),r+="}}";case 3:return e.previewWikitext=r,t.p=4,t.n=5,m.post({action:"parse",text:r,contentmodel:"wikitext",format:"json"});case 5:l=t.v,e.previewHtml=l.parse.text["*"],e.showPreview=!0,t.n=7;break;case 6:t.p=6,i=t.v,e.previewHtml='<div style="color:red;">预览出错：'.concat(i,"</div>"),e.showPreview=!0;case 7:return t.a(2)}},a,null,[[4,6]])}))()},sendToTalkPage:function(){var e=this;return r(t().m(function a(){var r,n,s;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:if(r=mw.config.get("wgRelevantUserName")){t.n=1;break}return mw.notify("无法获取目标用户名",{type:"error"}),t.a(2);case 1:return e.sending=!0,t.p=2,n=e.previewWikitext,!e.customMode&&e.selectedTemplate&&(n=e.previewWikitext.replace(/^{{/,"{{subst:")),t.n=3,m.postWithToken("csrf",{action:"edit",assertuser:mw.config.get("wgUserName"),format:"json",title:"User talk:".concat(r),section:"new",sectiontitle:"",text:"".concat(n," ——~~~~"),summary:e.editSummary,tags:"Automation tool|UserMessages"});case 3:mw.notify("已成功发送到讨论页",{type:"success"}),e.showPreview=!1,e.showDialog=!1,t.n=5;break;case 4:t.p=4,s=t.v,mw.notify("发送失败：".concat(s),{type:"error"});case 5:return t.p=5,e.sending=!1,t.f(5);case 6:return t.a(2)}},a,null,[[2,4,5,6]])}))()}},mounted:function(){s.addEventListener("click",this.openDialog)},unmounted:function(){s.removeEventListener("click",this.openDialog)}}).component("cdx-dialog",i.CdxDialog).component("cdx-field",i.CdxField).component("cdx-text-input",i.CdxTextInput).component("cdx-text-area",i.CdxTextArea).component("cdx-select",i.CdxSelect).component("cdx-button",i.CdxButton).component("cdx-checkbox",i.CdxCheckbox).mount(o)}})})();
//# sourceMappingURL=UserMessages.min.js.map