(()=>{"use strict";const t=[{title:"欢迎",template:"Template:UserMessages/Welcome",parameters:[],summary:"Welcome to Moegirlpedia~"},{title:"优质编辑者",template:"Template:UserMessages/GoodEditor",parameters:[{key:"1",label:"选填原因"}],summary:"恭喜您成为萌娘百科优质编辑者！"},{title:"可收录页面打回",template:"Template:UserMessages/MovedToUserSubpage",parameters:[{key:"1",label:"页面名"},{key:"2",label:"原因"}],summary:"页面打回通知"},{title:"非收录页面打回",template:"Template:UserMessages/MovedToUserSubpage2",parameters:[{key:"1",label:"页面名"},{key:"2",label:"原因"}],summary:"页面打回通知"},{title:"著作权侵犯",template:"Template:UserMessages/ArticleCopyright",parameters:[{key:"1",label:"页面名"},{key:"2",label:"选填站点"}],summary:"请勿侵犯著作权"},{title:"不实信息",template:"Template:UserMessages/FalseInformation",parameters:[{key:"1",label:"页面名"}],summary:"请勿添加不实信息"},{title:"Wiki语法",template:"Template:UserMessages/WikiMarkupLanguage",parameters:[],summary:"关于Wiki语法"},{title:"剪贴移动",template:"Template:UserMessages/CutAndPasteMoving",parameters:[{key:"1",label:"页面名"}],summary:"请勿剪切移动页面"},{title:"编辑用户页",template:"Template:UserMessages/EditUserPage",parameters:[{key:"1",label:"页面名"}],summary:"请勿编辑他人用户页面"},{title:"幽默模板",template:"Template:UserMessages/HumorTemplate",parameters:[{key:"1",label:"选填页面名"},{key:"2",label:"选填行为"}],summary:"关于幽默模板的使用"},{title:"违规字词转换",template:"Template:UserMessages/ConversionViolation",parameters:[{key:"1",label:"选填页面名"},{key:"2",label:"选填行为"}],summary:"关于您近期的编辑"},{title:"文件授权协议",template:"Template:UserMessages/FileLicense",parameters:[{key:"1",label:"文件名"}],summary:"关于您近期上传的文件"},{title:"截图文件授权",template:"Template:UserMessages/FileLicense2",parameters:[{key:"1",label:"文件名"}],summary:"关于您近期上传的截图文件"},{title:"用户文件",template:"Template:UserMessages/UserFile",parameters:[],summary:"关于您上传的文件"},{title:"修改历史发言",template:"Template:UserMessages/DiscussionViolation",parameters:[{key:"1",label:"选填页面名或差异"}],summary:"关于您在讨论区的发言"},{title:"违反讨论区方针",template:"Template:UserMessages/DiscussionViolation2",parameters:[{key:"1",label:"页面名或差异"},{key:"2",label:"原因"}],summary:"关于您在讨论区的发言"},{title:"删除历史发言",template:"Template:UserMessages/DiscussionViolation3",parameters:[{key:"1",label:"选填页面名或差异"}],summary:"关于您在讨论区的行为"},{title:"人身攻击提醒",template:"Template:UserMessages/PersonalAttacks",parameters:[{key:"1",label:"页面名"},{key:"2",label:"选填用户"}],summary:"请勿人身攻击"},{title:"人身攻击警告",template:"Template:UserMessages/PersonalAttacks2",parameters:[],summary:"人身攻击警告"},{title:"未签名",template:"Template:UserMessages/Signature",parameters:[{key:"1",label:"页面名"}],summary:"关于您的签名"},{title:"签名违规",template:"Template:UserMessages/Signature2",parameters:[{key:"1",label:"页面名"}],summary:"关于您的签名"},{title:"编辑战通知",template:"Template:UserMessages/EditWar",parameters:[{key:"1",label:"页面名"}],summary:"提醒您参与讨论"},{title:"编辑战提醒",template:"Template:UserMessages/EditWar2",parameters:[{key:"1",label:"页面名"}],summary:"编辑战提醒"},{title:"编辑战警告",template:"Template:UserMessages/EditWar3",parameters:[{key:"1",label:"页面名"},{key:"2",label:"选填原因"}],summary:"编辑战警告"},{title:"最终警告",template:"Template:UserMessages/FinalWarning",parameters:[{key:"1",label:"选填原因"},{key:"2",label:"选填原因"}],summary:"警告：忍耐是有限的"},{title:"大家族模板排序",template:"Template:UserMessages/NavSort",parameters:[{key:"1",label:"页面名"}],summary:"关于大家族模板的排序"},{title:"回复无缩进",template:"Template:UserMessages/ReplyNoIndentation",parameters:[{key:"1",label:"页面名"},{key:"2",label:"被回复人"}],summary:"关于您在讨论区的发言"},{title:"超速编辑",template:"Template:UserMessages/OverSpeedEdit",parameters:[],summary:"关于您近期的编辑"}];function e(){var t,r,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",l=n.toStringTag||"@@toStringTag";function i(e,n,s,l){var i=n&&n.prototype instanceof m?n:m,c=Object.create(i.prototype);return a(c,"_invoke",function(e,a,n){var s,l,i,m=0,c=n||[],p=!1,u={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,a){return s=e,l=0,i=t,u.n=a,o}};function d(e,a){for(l=e,i=a,r=0;!p&&m&&!n&&r<c.length;r++){var n,s=c[r],d=u.p,y=s[2];e>3?(n=y===a)&&(i=s[(l=s[4])?5:(l=3,3)],s[4]=s[5]=t):s[0]<=d&&((n=e<2&&d<s[1])?(l=0,u.v=a,u.n=s[1]):d<y&&(n=e<3||s[0]>a||a>y)&&(s[4]=e,s[5]=a,u.n=y,l=0))}if(n||e>1)return o;throw p=!0,a}return function(n,c,y){if(m>1)throw TypeError("Generator is already running");for(p&&1===c&&d(c,y),l=c,i=y;(r=l<2?t:i)||!p;){s||(l?l<3?(l>1&&(u.n=-1),d(l,i)):u.n=i:u.v=i);try{if(m=2,s){if(l||(n="next"),r=s[n]){if(!(r=r.call(s,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,l<2&&(l=0)}else 1===l&&(r=s.return)&&r.call(s),l<2&&(i=TypeError("The iterator does not provide a '"+n+"' method"),l=1);s=t}else if((r=(p=u.n<0)?i:e.call(a,u))!==o)break}catch(e){s=t,l=1,i=e}finally{m=1}}return{value:r,done:p}}}(e,s,l),!0),c}var o={};function m(){}function c(){}function p(){}r=Object.getPrototypeOf;var u=[][s]?r(r([][s]())):(a(r={},s,function(){return this}),r),d=p.prototype=m.prototype=Object.create(u);function y(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,a(t,l,"GeneratorFunction")),t.prototype=Object.create(d),t}return c.prototype=p,a(d,"constructor",p),a(p,"constructor",c),c.displayName="GeneratorFunction",a(p,l,"GeneratorFunction"),a(d),a(d,l,"Generator"),a(d,s,function(){return this}),a(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:y}})()}function a(t,e,r,n){var s=Object.defineProperty;try{s({},"",{})}catch(t){s=0}a=function(t,e,r,n){function l(e,r){a(t,e,function(t){return this._invoke(e,r,t)})}e?s?s(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(l("next",0),l("throw",1),l("return",2))},a(t,e,r,n)}function r(t,e,a,r,n,s,l){try{var i=t[s](l),o=i.value}catch(t){return void a(t)}i.done?e(o):Promise.resolve(o).then(r,n)}function n(t){return function(){var e=this,a=arguments;return new Promise(function(n,s){var l=t.apply(e,a);function i(t){r(l,n,s,i,o,"next",t)}function o(t){r(l,n,s,i,o,"throw",t)}i(void 0)})}}mw.loader.using(["mediawiki.api","@wikimedia/codex"]).then(function(a){var r=mw.config.get("wgNamespaceNumber"),s=mw.config.get("wgCanonicalSpecialPageName");if([1,2,-1].includes(r)&&(-1!==r||["Contributions","DeletedContributions","Block","Log"].includes(s))){var l=mw.util.addPortletLink("p-cactions","#","向用户发送提醒","p-usermessages"),i=a("vue"),o=a("@wikimedia/codex"),m=document.body.appendChild(document.createElement("div")),c=new mw.Api;mw.util.addCSS("\n\t\t.umdev-dialog-content {\n\t\t\tmax-height: 70vh;\n\t\t\toverflow-y: auto;\n\t\t\tpadding-right: 8px;\n\t\t}\n\t\t.umdev-textarea textarea {\n\t\t\tresize: vertical !important;\n\t\t\tmax-height: 400px;\n\t\t\toverflow-y: auto !important;\n\t\t}\n\t"),i.createMwApp({data:function(){return{showDialog:!1,selected:null,editSummary:"",showPreview:!1,previewHtml:"",previewWikitext:"",parameterValues:{},customMode:!1,customText:"",loadingSource:!1,sending:!1,templates:t,primaryAction:{label:"预览",actionType:"progressive"}}},computed:{menuItems:function(){return this.templates.map(function(t,e){return{label:t.title,value:e}})},selectedTemplate:function(){return null!==this.selected&&this.templates[this.selected]||null},previewActions:function(){return{default:{label:"关闭"},primary:{label:this.sending?"发送中...":"发送提醒",actionType:"progressive",disabled:this.sending}}}},watch:{selected:function(t){null!==t&&(this.editSummary=this.templates[t].summary,this.parameterValues={},this.customMode=!1,this.customText="")},customMode:function(t){var a=this;return n(e().m(function r(){return e().w(function(e){for(;;)switch(e.n){case 0:if(!t||!a.selectedTemplate){e.n=1;break}return e.n=1,a.loadTemplateSource(a.selectedTemplate.template);case 1:return e.a(2)}},r)}))()}},template:'\n\t\t\t\x3c!-- 主对话框 --\x3e\n\t\t\t<cdx-dialog\n\t\t\t\tv-model:open="showDialog"\n\t\t\t\ttitle="向用户发送提醒"\n\t\t\t\t:use-close-button="true"\n\t\t\t\t:primary-action="primaryAction"\n\t\t\t\t@primary="previewTemplate"\n\t\t\t>\n\t\t\t\t<div class="umdev-dialog-content">\n\t\t\t\t\t<cdx-field>\n\t\t\t\t\t\t<template #label>选择模板</template>\n\t\t\t\t\t\t<cdx-select\n\t\t\t\t\t\t\tv-model:selected="selected"\n\t\t\t\t\t\t\t:menu-items="menuItems"\n\t\t\t\t\t\t\tdefault-label="请选择模板"\n\t\t\t\t\t\t></cdx-select>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field v-if="selectedTemplate">\n\t\t\t\t\t\t<cdx-checkbox v-model="customMode">\n\t\t\t\t\t\t\t自定义内容\n\t\t\t\t\t\t</cdx-checkbox>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field\n\t\t\t\t\t\tv-for="(param, index) in (selectedTemplate?.parameters || [])"\n\t\t\t\t\t\t:key="index"\n\t\t\t\t\t\tv-if="selectedTemplate && !customMode"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #label>{{ param.label }}</template>\n\t\t\t\t\t\t<cdx-text-input v-model="parameterValues[param.key]"></cdx-text-input>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field>\n\t\t\t\t\t\t<template #label>编辑摘要</template>\n\t\t\t\t\t\t<cdx-text-input v-model="editSummary"></cdx-text-input>\n\t\t\t\t\t</cdx-field>\n\n\t\t\t\t\t<cdx-field v-if="customMode">\n\t\t\t\t\t\t<template #label>自定义内容</template>\n\t\t\t\t\t\t<cdx-text-area\n\t\t\t\t\t\t\tv-model="customText"\n\t\t\t\t\t\t\t:autosize="true"\n\t\t\t\t\t\t\trows="6"\n\t\t\t\t\t\t\tclass="umdev-textarea"\n\t\t\t\t\t\t></cdx-text-area>\n\t\t\t\t\t\t<div v-if="loadingSource">正在加载模板源代码...</div>\n\t\t\t\t\t</cdx-field>\n\t\t\t\t</div>\n\t\t\t</cdx-dialog>\n\n\t\t\t<cdx-dialog\n\t\t\t\tv-if="showPreview"\n\t\t\t\tv-model:open="showPreview"\n\t\t\t\ttitle="预览"\n\t\t\t\t:use-close-button="true"\n\t\t\t\t:default-action="previewActions.default"\n\t\t\t\t:primary-action="previewActions.primary"\n\t\t\t\t@default="showPreview = false"\n\t\t\t\t@primary="sendToTalkPage"\n\t\t\t>\n\t\t\t\t<div class="umdev-dialog-content" v-html="previewHtml"></div>\n\t\t\t</cdx-dialog>\n\t\t',methods:{openDialog:function(){this.showDialog=!0},loadTemplateSource:function(t){var a=this;return n(e().m(function r(){var n,s,l,i,o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return a.loadingSource=!0,e.p=1,e.n=2,c.get({action:"query",prop:"revisions",rvprop:"content",titles:t,formatversion:2});case 2:s=e.v,l=s.query.pages[0],i=(i=(null===(n=l.revisions)||void 0===n||null===(n=n[0])||void 0===n?void 0:n.content)||"").replace(/<noinclude>[\s\S]*?<\/noinclude>/gi,""),a.customText=i.trim(),e.n=4;break;case 3:e.p=3,o=e.v,a.customText="加载模板源代码失败：".concat(o);case 4:return e.p=4,a.loadingSource=!1,e.f(4);case 5:return e.a(2)}},r,null,[[1,3,4,5]])}))()},previewTemplate:function(){var t=this;return n(e().m(function a(){var r,n,s,l,i;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r="",!t.customMode){e.n=1;break}r=t.customText,e.n=3;break;case 1:if(s=t.selectedTemplate){e.n=2;break}return e.a(2);case 2:r="{{".concat(s.template),null!==(n=s.parameters)&&void 0!==n&&n.length&&s.parameters.forEach(function(e){var a=t.parameterValues[e.key];a&&(r+="|".concat(e.key,"=").concat(a))}),r+="}}";case 3:return t.previewWikitext=r,e.p=4,e.n=5,c.post({action:"parse",text:r,contentmodel:"wikitext",format:"json"});case 5:l=e.v,t.previewHtml=l.parse.text["*"],t.showPreview=!0,e.n=7;break;case 6:e.p=6,i=e.v,t.previewHtml='<div style="color:red;">预览出错：'.concat(i,"</div>"),t.showPreview=!0;case 7:return e.a(2)}},a,null,[[4,6]])}))()},sendToTalkPage:function(){var t=this;return n(e().m(function a(){var r,n,s;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=mw.config.get("wgRelevantUserName")){e.n=1;break}return mw.notify("无法获取目标用户名",{type:"error"}),e.a(2);case 1:return t.sending=!0,e.p=2,n=t.previewWikitext,!t.customMode&&t.selectedTemplate&&(n=t.previewWikitext.replace(/^{{/,"{{subst:")),e.n=3,c.postWithToken("csrf",{action:"edit",assertuser:mw.config.get("wgUserName"),format:"json",title:"User talk:".concat(r),section:"new",sectiontitle:"",text:"".concat(n," ——~~~~"),summary:t.editSummary,tags:"Automation tool|UserMessages"});case 3:mw.notify("已成功发送到讨论页",{type:"success"}),t.showPreview=!1,t.showDialog=!1,e.n=5;break;case 4:e.p=4,s=e.v,mw.notify("发送失败：".concat(s),{type:"error"});case 5:return e.p=5,t.sending=!1,e.f(5);case 6:return e.a(2)}},a,null,[[2,4,5,6]])}))()}},mounted:function(){l.addEventListener("click",this.openDialog)},unmounted:function(){l.removeEventListener("click",this.openDialog)}}).component("cdx-dialog",o.CdxDialog).component("cdx-field",o.CdxField).component("cdx-text-input",o.CdxTextInput).component("cdx-text-area",o.CdxTextArea).component("cdx-select",o.CdxSelect).component("cdx-button",o.CdxButton).component("cdx-checkbox",o.CdxCheckbox).mount(m)}})})();
//# sourceMappingURL=UserMessages.min.js.map