(()=>{"use strict";function t(){var n,e,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(t,o,i,a){var c=o&&o.prototype instanceof f?o:f,l=Object.create(c.prototype);return r(l,"_invoke",function(t,r,o){var i,a,c,f=0,l=o||[],s=!1,p={p:0,n:0,v:n,a:y,f:y.bind(n,4),d:function(t,r){return i=t,a=0,c=n,p.n=r,u}};function y(t,r){for(a=t,c=r,e=0;!s&&f&&!o&&e<l.length;e++){var o,i=l[e],y=p.p,g=i[2];t>3?(o=g===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=y&&((o=t<2&&y<i[1])?(a=0,p.v=r,p.n=i[1]):y<g&&(o=t<3||i[0]>r||r>g)&&(i[4]=t,i[5]=r,p.n=g,a=0))}if(o||t>1)return u;throw s=!0,r}return function(o,l,g){if(f>1)throw TypeError("Generator is already running");for(s&&1===l&&y(l,g),a=l,c=g;(e=a<2?n:c)||!s;){i||(a?a<3?(a>1&&(p.n=-1),y(a,c)):p.n=c:p.v=c);try{if(f=2,i){if(a||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=i.return)&&e.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=n}else if((e=(s=p.n<0)?c:t.call(r,p))!==u)break}catch(t){i=n,a=1,c=t}finally{f=1}}return{value:e,done:s}}}(t,i,a),!0),l}var u={};function f(){}function l(){}function s(){}e=Object.getPrototypeOf;var p=[][i]?e(e([][i]())):(r(e={},i,function(){return this}),e),y=s.prototype=f.prototype=Object.create(p);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,r(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t}return l.prototype=s,r(y,"constructor",s),r(s,"constructor",l),l.displayName="GeneratorFunction",r(s,a,"GeneratorFunction"),r(y),r(y,a,"Generator"),r(y,i,function(){return this}),r(y,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:g}})()}function r(t,n,e,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}r=function(t,n,e,o){function a(n,e){r(t,n,function(t){return this._invoke(n,e,t)})}n?i?i(t,n,{value:e,enumerable:!o,configurable:!o,writable:!o}):t[n]=e:(a("next",0),a("throw",1),a("return",2))},r(t,n,e,o)}function n(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=Array(r);n<r;n++)e[n]=t[n];return e}function o(t,r,n,e,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?r(u):Promise.resolve(u).then(e,o)}function i(t){return function(){var r=this,n=arguments;return new Promise(function(e,i){var a=t.apply(r,n);function c(t){o(a,e,i,c,u,"next",t)}function u(t){o(a,e,i,c,u,"throw",t)}c(void 0)})}}i(t().m(function r(){var e,o;return t().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,$.ready;case 1:return r.n=2,mw.loader.using(["mediawiki.util","mediawiki.api"]);case 2:if(e=mw.config.get("wgPageName"),mw.config.get("wgIsArticle")&&(0!==mw.config.get("wgRevisionId")||0!==mw.config.get("wgArticleId"))){r.n=3;break}return r.a(2);case 3:o=mw.util.addPortletLink("p-cactions","#","复制图片外链","CopyImglink","复制图片外链"),$(o).on("click",function(){var r=i(t().m(function r(o){var i,a,c,u,f,l;return t().w(function(t){for(;;)switch(t.p=t.n){case 0:return o.preventDefault(),t.p=1,i=new Set,document.querySelectorAll(".moe-img-error[data-src-input]").forEach(function(t){i.add(t.getAttribute("data-src-input"))}),document.querySelectorAll(".moe-img-blocked[href]").forEach(function(t){i.add(t.getAttribute("href"))}),t.n=2,(new mw.Api).get({action:"query",prop:"revisions",rvprop:"content",titles:e,formatversion:2});case 2:if(a=t.v,c=a.query.pages[0].revisions[0].content||"",u=/\bhttps?:\/\/[^\s<>"]+\.(?:png|jpe?g|gif|svg|webp)/gi,(c.match(u)||[]).forEach(function(t){return i.add(t)}),(f=n(i)).length){t.n=3;break}return mw.notify("未找到外链图片。"),t.a(2);case 3:return t.n=4,navigator.clipboard.writeText(f.join("\n"));case 4:mw.notify("已复制 ".concat(f.length," 个外链图片链接到剪贴板。"),{type:"success"}),t.n=6;break;case 5:t.p=5,l=t.v,console.error(l),mw.notify("获取外链图片出错。",{type:"error"});case 6:return t.a(2)}},r,null,[[1,5]])}));return function(t){return r.apply(this,arguments)}}());case 4:return r.a(2)}},r)}))()})();
//# sourceMappingURL=CopyImglink.min.js.map