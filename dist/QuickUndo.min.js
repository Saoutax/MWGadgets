$(function(){function i(n,e,t){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];(new mw.Api).getToken("csrf").then(function(f){ajaxdata={action:"edit",format:"json",pageid:n,summary:"// QuickUndo",undo:e,token:f},t&&(ajaxdata.undoafter=t),mw.notify("正在操作"),$.ajax({type:"POST",url:"/api.php",data:ajaxdata,success:function(f){f.edit&&"Success"==f.edit.result?null!=f.edit.nochange?mw.notify("这次编辑似乎已被撤销。"):(mw.notify("完成"),setTimeout(function(){window.open("/Special:Diff/"+f.edit.newrevid)},0)):f.edit&&"Failure"==f.edit.result&&f.edit.abusefilter&&-1!=f.edit.abusefilter.actions.indexOf("warn")&&o?(mw.notify("遇到过滤器"+f.edit.abusefilter.id+"（"+f.edit.abusefilter.description+"），忽略警告"),setTimeout(function(){i(n,e,t,!1)},0)):f.error&&"The edit could not be undone due to conflicting intermediate edits."==f.error.info?mw.notify("因存在冲突的中间编辑，本编辑不能撤销。"):(mw.notify("出现未知错误，以下是错误信息:"+JSON.stringify(f)),console.log(JSON.stringify(f)))},error:function(){mw.notify("网络连接出错")}})}).catch(function(){mw.notify("获取编辑令牌失败")})}if((mw.config.values.wgDiffNewId||mw.config.values.wgDiffOldId)&&($(".mw-diff-undo").each(function(){this.innerHTML=this.innerHTML.replace(/）$/,'/<a href="#." title = "无需确定并忽略过滤器警告" class="quickundo_diff">快速撤销</a >）')}),$("a.quickundo_diff").each(function(){this.onclick=function(){i(mw.config.values.wgArticleId,mw.config.values.wgDiffNewId,mw.config.values.wgDiffOldId)}})),"history"==mw.config.values.wgAction){$(".mw-history-undo").append('/<a href="#." title = "无需确定并忽略过滤器警告" class="quickundo_history">快速撤销</a >'),$("a.quickundo_history").each(function(){this.onclick=function(){var n=$(this).parents("span.mw-history-undo").children("a:not(.quickundo_history)")[0].href,e=n.match(/undo=(\d+)/)[1],t=n.match(/undoafter=(\d+)/)[1];i(mw.config.values.wgArticleId,e,t)}});var n=$(".history-user:first .mw-userlink:first")[0].href,e=-1,t=0;$.each($(".history-user .mw-userlink"),function(){if(this.href!=n)return e=$(this).parents("li")[0].dataset.mwRevid,!1;t++});var o=document.createElement("a");o.innerText="回退"+t+"次的编辑",o.href="#.",o.onclick=function(){i(mw.config.values.wgArticleId,mw.config.values.wgCurRevisionId,e)},$("#pagehistory li:first").append("[").append(o).append("]")}window.QuickDiffExtension=window.QuickDiffExtension||[],window.QuickDiffExtension.push(function(n,e){$(n).find("#quick-diff-content").prepend('<input class="quick-undo-quick-diff" title="无需确定并忽略过滤器警告" type="submit" value="快速撤销此编辑">'),$(n).find("input.quick-undo-quick-diff").each(function(){this.onclick=function(){i(e.compare.fromid,e.compare.fromrevid,e.compare.torevid)}})})});
//# sourceMappingURL=QuickUndo.min.js.map